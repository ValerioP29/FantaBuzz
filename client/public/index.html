<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FantaBid 2.9</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#1d4ed8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="/styles.css?v=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">FantAstaBuzz</div>
    <div class="topbar-actions">
      <button id="btnLogout" class="btn btn-outline btn-sm">Esci</button>
      <button id="btnHostExitAndClose" class="btn btn-danger">Chiudi asta</button>
    </div>
  </header>

  <section id="screenLogin" class="screen">
    <div class="card card-lg intro">
      <h1>Entra nell’asta</h1>
      <div class="grid">
        <input id="regName" class="input" placeholder="Nome squadra" />
        <input id="regCredits" class="input" type="number" min="0" placeholder="Crediti posseduti" />
      </div>
      <label class="toggle">
        <input type="checkbox" id="regHost" />
        <span class="knob"></span><span class="label">Dirigi l’asta</span>
      </label>
      <button id="btnEnter" class="btn btn-primary">Entra</button>
    </div>
  </section>

  <section id="screenMain" class="screen hidden">
    <div id="hostViewSwitch" class="host-switch host-switch-bar" style="display:none">
      <button id="btnHostViewSummary" class="btn btn-outline">Riepilogo</button>
      <button id="btnHostViewControls" class="btn btn-outline">Controlli</button>
    </div>
    <div class="wrap" id="mainWrap" data-host-view="summary">
     <aside class="col col-left">
  <!-- CONTROLLI (solo per host, nella vista "Controlli") -->
  <div class="card" id="ctrlCard">
    <div class="row space-between">
      <h2>Controllo</h2>
      <div class="chip" id="hostStatus">Partecipante</div>
    </div>

    <div class="row gap">
      <button id="btnHostToggle" class="btn btn-outline">Banditore</button>
      <div class="row gap">
        <button id="btnHostSkip" class="btn btn-outline">Salta</button>
        <button id="btnHostBackN" class="btn btn-outline">Indietro di N</button>
      </div>
    </div>

    <div class="rolebar" id="rolebar">
      <button class="role btn" data-role="P">P</button>
      <button class="role btn" data-role="D">D</button>
      <button class="role btn" data-role="C">C</button>
      <button class="role btn" data-role="A">A</button>
      <button id="btnRandom" class="btn btn-outline">Random</button>
      <input id="searchPlayer" class="input" placeholder="Cerca giocatore..." style="margin-left:.5rem; width: 14rem;" />
    </div>
  </div>

  <!-- PARTECIPANTI (sempre visibile; se sei host compaiono i bottoni Rimuovi) -->
  <div class="card" id="participantsCard">
    <header>
      <h2 class="card-title">Partecipanti</h2>
      <span class="card-meta" id="participantsCount" aria-live="polite">0</span>
    </header>
    <details open>
      <summary class="summary-title">Elenco manager</summary>
      <ul id="manageList" class="list mt-sm"></ul>
    </details>
  </div>

  <!-- AGGIUDICAZIONI RECENTI (sempre visibile; se sei host compaiono i bottoni Elimina) -->
  <div class="card" id="historyCard">
    <header>
      <h2 class="card-title">Aggiudicazioni</h2>
      <span class="card-meta" id="historyCount" aria-live="polite">0</span>
    </header>
    <details>
      <summary class="summary-title">Log recente</summary>
      <ul id="historyList" class="list mt-sm"></ul>
    </details>
  </div>

  <!-- IMPORT / EXPORT (solo per host, nella vista "Controlli") -->
  <div class="card" id="importCard">
    <header>
      <h2 class="card-title">Import/Export</h2>
    </header>
    <details open>
      <summary class="summary-title">Importa liste</summary>
      <div class="stack mt-sm">
        <div class="row gap">
          <button id="btnImportFile" class="btn btn-primary">Importa XLSX/CSV</button>
          <input id="fileImport" type="file" accept=".xlsx,.csv" style="display:none" />
        </div>
        <p class="muted card-note">
          Atteso Excel con colonne: <code>Nome</code>, <code>Fuori lista</code>, <code>Sq.</code>, <code>R.</code>, <code>FM</code>.
          Le righe con <code>Fuori lista = *</code> vengono scartate. <code>R.</code> normalizzato in P/D/C/A. <code>FM</code> accetta la virgola.
        </p>
      </div>
    </details>
    <div class="card-divider" role="presentation"></div>
    <footer>
      <div class="row gap">
        <a class="btn btn-outline" href="/api/export/teams.csv" target="_blank" rel="noopener">Export squadre (CSV)</a>
        <a class="btn btn-outline" href="/api/export/history.csv" target="_blank" rel="noopener">Export aggiudicazioni (CSV)</a>
        <a class="btn btn-outline" href="/api/export/all.json" target="_blank" rel="noopener">Export completo (JSON)</a>
      </div>
      <div class="row gap mt-sm">
        <a id="btnExportMy" class="btn btn-outline" href="#" target="_blank" rel="noopener">Export mia rosa (CSV)</a>
        <a class="btn btn-outline" href="/api/export/remaining.csv" target="_blank" rel="noopener">Listone residuo (CSV)</a>
      </div>
    </footer>
  </div>
</aside>


      <main class="col col-right col-main">
         <div id="rollControls" class="roll-controls" style="display:none">
        <button id="btnRollToggle" class="btn">▶</button>
        <select id="hostRollMs" class="btn">
          <option value="2000">0.5x</option>
          <option value="1000" selected>1x</option>
          <option value="500">2x</option>
        </select>
      </div>

        <div class="card highlight summary-card">

         <div class="slot" aria-live="polite" aria-atomic="true">
            <div class="slot-inner" id="slotInner"></div>
          </div>

          <div class="summary" role="status" aria-live="polite" aria-atomic="true">
            <div class="summary-item"><div class="label">Offerta</div><div class="value" id="sumBid">0</div></div>
            <div class="summary-item"><div class="label">Leader</div><div class="value" id="sumLeader">—</div></div>
            <div class="summary-item"><div class="label">I tuoi crediti</div><div class="value" id="sumCredits">—</div></div>
            <div class="summary-item countdown-wrap" role="status" aria-live="polite" aria-atomic="true">
            <div class="label">Countdown</div><div class="countdown" id="countdown">—</div>
            </div>
          </div>
          <div id="bidsBox" class="bids">
            <button class="btn inc" data-inc="1">+1</button>
            <button class="btn inc" data-inc="2">+2</button>
            <button class="btn inc" data-inc="3">+3</button>
            <button class="btn inc" data-inc="5">+5</button>
            <button class="btn inc" data-inc="10">+10</button>
            <div class="freebid">
              <input id="freeBid" class="input" type="number" min="0" placeholder="Offerta libera" />
              <button id="btnFreeBid" class="btn btn-outline">Offri</button>
            </div>
          </div>
        </div>

        <div class="card" id="acqCard">
          <header>
            <h3 class="card-title">I tuoi acquisti</h3>
            <span class="card-meta" id="acqCount" aria-live="polite">0</span>
          </header>
          <ul id="acqList" class="list list-cards mt-sm"></ul>
        </div>
      </main>
    </div>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <!-- SheetJS per lettura XLSX lato client -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="/app.js?v=1"></script>
</body>
</html>
